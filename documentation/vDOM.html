<h1 id="virtual-dom">Virtual DOM</h1>
<pre><code class="lang-js"><span class="hljs-attribute">var htmlParser</span> = require(<span class="hljs-string">'html-parser'</span>);
</code></pre>
<h2 id="sets-the-root-node-to-changed-">sets the root node to &quot;changed&quot;</h2>
<pre><code class="lang-js">function setChanged(<span class="hljs-keyword">node</span><span class="hljs-title">) {
    while</span> (<span class="hljs-keyword">node</span>.<span class="hljs-title">parentNode</span>) {
        <span class="hljs-keyword">node</span> <span class="hljs-title">= node</span>.parentNode;
    }
    <span class="hljs-keyword">node</span>.<span class="hljs-title">changed</span> = <span class="hljs-literal">true</span>;
}
</code></pre>
<h2 id="exports-the-vdom-api">exports the vDOM api</h2>
<pre><code class="lang-js"><span class="hljs-built_in">module</span>.exports = {
    <span class="hljs-attribute">createVDOM</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">html</span>) </span>{
        <span class="hljs-built_in">var</span> cNode = {
            <span class="hljs-attribute">name</span>: <span class="hljs-string">"root"</span>,
            <span class="hljs-attribute">parentNode</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attribute">attributes</span>: {},
            <span class="hljs-attribute">classNames</span>: [],
            <span class="hljs-attribute">path</span>: <span class="hljs-string">""</span>,
            <span class="hljs-attribute">children</span>: [],
            <span class="hljs-attribute">id:</span><span class="hljs-string"> null</span>,
            <span class="hljs-attribute">text</span>: <span class="hljs-string">""</span>
        };
        htmlParser.parse(html.replace(<span class="hljs-regexp">/\r?\n|\r/g</span>, <span class="hljs-string">""</span>), {
            <span class="hljs-attribute">openElement</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{
                <span class="hljs-built_in">var</span> node = {
                    <span class="hljs-attribute">name</span>: name,
                    <span class="hljs-attribute">parentNode</span>: cNode,
                    <span class="hljs-attribute">attributes</span>: {},
                    <span class="hljs-attribute">children</span>: [],
                    <span class="hljs-attribute">classNames</span>: [],
                    <span class="hljs-attribute">id:</span><span class="hljs-string"> null</span>,
                    <span class="hljs-attribute">text</span>: <span class="hljs-string">""</span>
                };
                cNode.children.push(node);
                cNode = node;
            },
            <span class="hljs-attribute">closeOpenedElement</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, token, unary</span>) </span>{
                <span class="hljs-keyword">if</span> (unary &amp;&amp; cNode.name === name)
                    cNode = cNode.parentNode;
            },
            <span class="hljs-attribute">closeElement</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{
                <span class="hljs-keyword">if</span> (cNode.name === name)
                    cNode = cNode.parentNode;
            },
            <span class="hljs-attribute">comment</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
</code></pre>
<p>console.log(&#39;comment: %s&#39;, value);</p>
<pre><code class="lang-js">            },
            cdata: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> </span>{
</code></pre>
<p>console.log(&#39;cdata: %s&#39;, value);</p>
<pre><code class="lang-js">            },
            attribute: <span class="hljs-function"><span class="hljs-keyword">function</span></span> (<span class="hljs-keyword">name</span>, <span class="hljs-keyword">value</span>) {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">name</span> === <span class="hljs-string">"id"</span>)
                    cNode.id = <span class="hljs-keyword">value</span>;
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">name</span> === <span class="hljs-string">"class"</span>)
                    cNode.classNames.push(<span class="hljs-keyword">value</span>.split(<span class="hljs-string">" "</span>));
                cNode.attributes[<span class="hljs-keyword">name</span>] = <span class="hljs-keyword">value</span>;
            },
            docType: <span class="hljs-function"><span class="hljs-keyword">function</span></span> (<span class="hljs-keyword">value</span>) {
</code></pre>
<p>console.log(&#39;doctype: %s&#39;, value);</p>
<pre><code class="lang-js">            },
            text: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> </span>{
                cNode.text += value;
            }
        });
        <span class="hljs-keyword">return</span> cNode;
    },
    addChildFromHtml: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(nodes, arg)</span> </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;nodes.length; i++) {
            <span class="hljs-keyword">var</span> newDOM = <span class="hljs-keyword">this</span>.createVDOM(arg);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j=<span class="hljs-number">0</span>; j&lt;newDOM.children.length; j++) {
                newDOM.children[j].parentNode = nodes[i];
                nodes[i].children.push(newDOM.children[j]);
            }
        }
        setChanged(nodes[<span class="hljs-number">0</span>]);
    },
    removeNode: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(nodes)</span> </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;nodes.length; i++) {
            <span class="hljs-keyword">var</span> node = nodes[i];
            node.parentNode.children.splice(node.parentNode.children.indexOf(node),<span class="hljs-number">1</span>);
        }
        setChanged(nodes[<span class="hljs-number">0</span>]);
    },
    addClasses: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(nodes, classes)</span> </span>{
        classes = classes.split(<span class="hljs-string">' '</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;nodes.length; i++) {
            <span class="hljs-keyword">var</span> node = nodes[i];
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j=<span class="hljs-number">0</span>; j&lt;classes.length; j++) {
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> classes[j] === <span class="hljs-string">"undefined"</span>) <span class="hljs-keyword">continue</span>;
                    <span class="hljs-keyword">if</span> (node.classNames.indexOf(classes[j]) === <span class="hljs-number">-1</span>) {
                        node.classNames.push(classes[j]);
                        node.attributes.class = node.classNames.join(<span class="hljs-string">' '</span>);
                    }
                }
        }
        setChanged(nodes[<span class="hljs-number">0</span>]);
    },
    setHTML: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(nodes, html)</span> </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;nodes.length; i++) {
            <span class="hljs-keyword">var</span> node = nodes[i];
            node.children = <span class="hljs-keyword">this</span>.createVDOM(html).children;    
        }
        setChanged(nodes[<span class="hljs-number">0</span>]);
    }
}
</code></pre>
<hr>
<p>Generated <em>Wed Sep 14 2016 11:26:49 GMT+0200 (CEST)</em> from <a href="vDOM.js" title="View in source">&#x24C8; vDOM.js</a></p>
